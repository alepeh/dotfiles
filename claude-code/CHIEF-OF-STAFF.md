# Chief-of-Staff Agent

A semi-autonomous daily briefing loop built on Claude Code slash commands and four MCP integrations: Gmail, Google Calendar, Todoist, and Obsidian.

## Design Principles

- **Request-response, not a daemon.** Claude Code is not an event-driven system. The agent runs when you invoke it, not continuously. No webhooks, no push notifications.
- **Human in the loop.** The agent reads freely but never acts without approval. Emails are drafted, never sent. Tasks are proposed, then confirmed. Calendar is read-only.
- **Obsidian is the state store.** There is no separate database. The daily journal (`journals/YYYY-MM-DD.md`) persists state between runs via structured headings.
- **Idempotent re-runs.** Running a command twice on the same day replaces the existing section rather than duplicating it.
- **Everything is linked.** Every item in the brief links back to its source â€” Todoist task, Gmail email, Obsidian note, or Calendar day view. Clickable in both the terminal and Obsidian.

## Link Formats

All items reference their source with clickable links, in both the conversation and the Obsidian journal output.

| Source | URL Template | ID Source |
|--------|-------------|-----------|
| Todoist task | `https://app.todoist.com/showTask?id={task_id}` | `id` field from `find-tasks-by-date` / `find-completed-tasks` |
| Gmail email | `https://mail.google.com/mail/u/0/#all/{email_id}` | `id` field from `query_gmail_emails` |
| Obsidian note | `obsidian://open?vault=brain&file={path_without_extension}` | Known path, e.g. `journals/2026-02-08` |
| Google Calendar | `https://calendar.google.com/calendar/u/0/r/day/{YYYY}/{MM}/{DD}` | Date-based (individual event URLs not available via MCP) |

In Obsidian output, use standard Markdown links (`[text](url)`) rather than wikilinks, so external URLs (Gmail, Todoist) are clickable.

## Commands

| Command | When | What it does |
|---------|------|--------------|
| `/morning-brief` | Start of day | Fetches Gmail, Calendar, Todoist, yesterday's journal. Synthesises priorities. Writes to Obsidian. Presents approval queue. |
| `/evening-recap` | End of day | Compares morning plan vs. reality. Logs completions and carry-overs. Flags escalations. Updates follow-ups for tomorrow. |

## Data Sources

| Source | MCP Tool | What's fetched | Limits |
|--------|----------|---------------|--------|
| Gmail | `query_gmail_emails` | Unread, last 24h (morning) / 12h (evening) | 25 / 15 emails, subject+sender only |
| Calendar | `get_calendar_events` | Today + tomorrow (morning) / today only (evening) | All events |
| Todoist | `find-tasks-by-date` | Due today + overdue | 30 tasks |
| Todoist | `find-completed-tasks` | Completed today (evening only) | By completion date |
| Obsidian | `obsidian_get_file_contents` | Yesterday's journal, recent journals for patterns | Headings + relevant sections only |

## Journal Structure

Each daily journal (`journals/YYYY-MM-DD.md`) accumulates the following headings over the course of a day. Not all will be present â€” only those generated by actual runs.

```
# Morning Brief
*Generated at 07:30 on 2026-02-08*

### Task Overview
ðŸ”´ [ZulassungsprÃ¼fung Pelletsofen](https://app.todoist.com/showTask?id=8401) â€” overdue since Feb 5
ðŸŸ¡ [Angebot Burggrabengasse](https://app.todoist.com/showTask?id=8402) â€” due today, p1
ðŸŸ¢ [Kehrbuch Q1 vorbereiten](https://app.todoist.com/showTask?id=8403) â€” in progress
âšª [Website-Relaunch planen](https://app.todoist.com/showTask?id=8404) â€” due Feb 15

### Priorities
**URGENT**
- [ZulassungsprÃ¼fung Pelletsofen](https://app.todoist.com/showTask?id=8401) â€” overdue, client waiting (Todoist)
- [Re: Pelletskesselofen 42kW](https://mail.google.com/mail/u/0/#all/19c3e37951ba05c2) â€” needs reply, vendor sent specs (Gmail)
**OPERATIVE**
- [Angebot Burggrabengasse](https://app.todoist.com/showTask?id=8402) â€” deadline today (Todoist)
**STRATEGIC**
- Website-Relaunch â€” recurring theme, appeared 3x this week ([Feb 5](obsidian://open?vault=brain&file=journals/2026-02-05), [Feb 6](obsidian://open?vault=brain&file=journals/2026-02-06), [Feb 7](obsidian://open?vault=brain&file=journals/2026-02-07))

### Today's Schedule
- 09:00 â€” Teammeeting (weekly standup, 30min)
- 14:00 â€” Kundenbesichtigung Meidling (external, prep needed)

### Emails Needing Attention
**Needs Reply**
- [Re: Pelletskesselofen 42kW](https://mail.google.com/mail/u/0/#all/19c3e37951ba05c2) â€” Mijajlovic sent product links â†’ implied to-do: check Austrian certification
**FYI Only**
- [Rechnung JÃ¤nner](https://mail.google.com/mail/u/0/#all/19c3e12345678) â€” accounting, no action needed

### Carry-overs & Follow-ups
- From [yesterday's recap](obsidian://open?vault=brain&file=journals/2026-02-07): Wartungsprotokoll review still pending

## Decisions
- Created [Zulassungsstatus prÃ¼fen](https://app.todoist.com/showTask?id=8410) based on [Mijajlovic email](https://mail.google.com/mail/u/0/#all/19c3e37951ba05c2)
- Drafted reply to Mijajlovic ([CoS Draft] in Gmail)
- Skipped newsletter from Kaminkehrer-Verband

## Follow-up Next Session
- Check if reply from [Mijajlovic](https://mail.google.com/mail/u/0/#all/19c3e37951ba05c2) arrived
- Review Besichtigung notes after 14:00 appointment

# Evening Recap
*Generated at 18:00 on 2026-02-08*

### Completed Today
ðŸŸ¢ [Angebot Burggrabengasse](https://app.todoist.com/showTask?id=8402)
ðŸŸ¢ [Zulassungsstatus prÃ¼fen](https://app.todoist.com/showTask?id=8410)

### Still Open
ðŸ”´ [ZulassungsprÃ¼fung Pelletsofen](https://app.todoist.com/showTask?id=8401) â€” was URGENT, waiting on Mijajlovic reply
ðŸŸ¡ [Kehrbuch Q1 vorbereiten](https://app.todoist.com/showTask?id=8403) â€” OPERATIVE, 60% done

### Escalations
- [ZulassungsprÃ¼fung Pelletsofen](https://app.todoist.com/showTask?id=8401) has been open for 4 days â€” reprioritize or delegate?

### New Items
- [Terminanfrage Neubaugasse](https://mail.google.com/mail/u/0/#all/19c3f98765432) â€” new client, needs scheduling

### Tomorrow's Setup
**URGENT**
- [ZulassungsprÃ¼fung Pelletsofen](https://app.todoist.com/showTask?id=8401) â€” follow up with Mijajlovic
**OPERATIVE**
- [Kehrbuch Q1 vorbereiten](https://app.todoist.com/showTask?id=8403) â€” finish remaining 40%
- Schedule appointment for Neubaugasse inquiry

## CoS Feedback
(User writes corrections here manually â€” agent reads on next run)
```

## Priority Categories

Items are grouped into three categories instead of a flat priority list:

| Category | What belongs here | Urgency |
|----------|-------------------|---------|
| **URGENT** | Overdue tasks, today's hard deadlines, emails needing same-day reply | Must act today |
| **OPERATIVE** | Ongoing business, routine follow-ups, this week's deadlines | This week |
| **STRATEGIC** | Longer-term items, recurring themes, items that keep slipping | Important but not urgent |

## Status Indicators

| Indicator | Meaning | When used |
|-----------|---------|-----------|
| ðŸ”´ | Overdue / was URGENT and still not done | Task overview, evening "Still Open" |
| ðŸŸ¡ | Due today/this week, high priority (p1/p2) / OPERATIVE carry-over | Task overview, evening "Still Open" |
| ðŸŸ¢ | In progress or completed | Task overview, evening "Completed Today" |
| âšª | Planned for later / STRATEGIC, no change expected | Task overview, evening "Still Open" |

## Implicit To-Do Detection

Emails that don't explicitly ask for something but *imply* an action get flagged. Examples:

- Vendor sends product documentation â†’ "Review documents, check Austrian certification"
- Client mentions a problem in passing â†’ "Follow up on reported issue"
- Colleague shares a link without comment â†’ "Review shared resource"

These appear in the approval queue as suggestions, never auto-created.

## Escalation Logic (Evening Recap)

The evening recap flags items that show signs of stalling:

| Trigger | Message |
|---------|---------|
| Task overdue 3+ days | "This task has been open for N days â€” reprioritize, delegate, or drop?" |
| Same topic rescheduled 3+ times | "This keeps getting pushed â€” is there a blocker?" |
| Many overdue items in one project | "[Project] has N overdue items â€” is this project stalled?" |

## Feedback Loop

```
Morning Brief                Evening Recap              Next Morning
     |                            |                          |
     |  writes Decisions          |  appends Decisions       |
     |  writes Follow-up          |  replaces Follow-up      |
     |                            |                          |
     |                            |     CoS Feedback         |
     |                            |     (user writes         |
     |                            |      manually)           |
     |                            |           |              |
     +----------------------------+-----------+--> reads all three
```

- **Decisions**: Accumulates throughout the day. Morning writes initial entries, evening appends.
- **Follow-up Next Session**: Evening replaces with the final list. Next morning reads it.
- **CoS Feedback**: User writes corrections/preferences at any time. Next run reads and applies them.

## Pattern Recognition

The morning brief scans the last 3-5 journal entries for recurring topics. If a theme appears 3+ times, it gets flagged:

> "Recurring theme: ZulassungsprÃ¼fung â€” appeared 3 times recently. Consider creating a dedicated project or systematic approach."

This catches items that keep surfacing but never get properly tracked.

## Todoist Conventions

- **Label**: All agent-created tasks use the `chief-of-staff` label
- **Dedup**: Before creating a task, the agent searches for existing tasks with the same label and similar content
- **Carry-overs**: Evening recap offers to reschedule existing tasks or create new ones for tomorrow

## Guardrails

| Action | Permission |
|--------|-----------|
| Read Gmail, Calendar, Todoist, Obsidian | Auto â€” no approval needed |
| Append/patch Obsidian journal headings | Auto â€” no approval needed |
| Create Todoist tasks (with `chief-of-staff` label) | After approval in conversation |
| Create Gmail draft (subject prefixed `[CoS Draft]`) | After approval in conversation |
| Send Gmail | Never â€” always draft only |
| Create/modify calendar events | Never â€” flag for manual action |
| Delete anything (tasks, emails, notes) | Never |

## Context Window Management

The commands are designed to stay within context limits on a typical day:

| Data | Cap | Strategy |
|------|-----|----------|
| Emails | 25 morning / 15 evening | Subject + sender + snippet only, no full bodies |
| Tasks | 30 | Content + project + priority + due date |
| Calendar | All events | Title + time + one-line context |
| Journal reads | Headings + sections | Skip large entries, read only CoS-relevant headings |
| Recent journals (pattern scan) | 3-5 entries | Headings and Follow-up sections only |

## Future Phases

### Phase 2: Scheduled CLI Runs

Once prompts are dialled in, automate via launchd:

```bash
claude -p "$(cat ~/.claude/commands/morning-brief.md)" \
  --allowedTools "mcp__mcp-gsuite__*,mcp__mcp-obsidian__*,mcp__todoist__*" \
  --output-format json > /tmp/morning-brief-$(date +%F).json
```

- 07:30 morning brief, 18:00 evening recap
- macOS notification via `osascript` when done
- Approval items written to Obsidian; user processes in next interactive session

### Phase 3: Interactive Sessions

Use Cowork or Claude web for tasks needing back-and-forth:
- Meeting prep (user confirms which meetings need prep packs)
- Email drafting (user reviews each draft)
- Weekly planning sessions
